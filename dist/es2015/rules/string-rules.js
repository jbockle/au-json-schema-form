var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
import { ValidationRules, validationMessages } from "aurelia-validation";
import { inject } from "aurelia-framework";
import { SchemaFormConfiguration } from "../services/schema-form-configuration";
let StringRules = class StringRules {
    constructor(configuration) {
        this.configuration = configuration;
    }
    register() {
        this.add();
        this.setCustomMessages();
    }
    setCustomMessages() {
        validationMessages["minLength"] = this.configuration.messages.minLength || validationMessages["minLength"];
        validationMessages["maxLength"] = this.configuration.messages.maxLength || validationMessages["maxLength"];
        validationMessages["matches"] = this.configuration.messages.pattern || validationMessages["matches"];
        validationMessages["email"] = this.configuration.messages.format_email || validationMessages["email"];
    }
    add() {
        // format datetime
        // tslint:disable-next-line:max-line-length
        const iso8601Datetime = /^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i;
        ValidationRules
            .customRule("format_datetime", (val) => val !== undefined ? iso8601Datetime.test(val) : true, this.configuration.messages.format_datetime || "${$displayName} is not a valid date/time");
        // format date
        const iso8601Date = /^\d\d\d\d-[0-1]\d-[0-3]\d$/;
        ValidationRules
            .customRule("format_date", (val) => val !== undefined ? iso8601Date.test(val) : true, this.configuration.messages.format_date || "${$displayName} is not a valid date");
        // format time
        const iso8601Time = /^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i;
        ValidationRules
            .customRule("format_time", (val) => val !== undefined ? iso8601Time.test(val) : true, this.configuration.messages.format_time || "${$displayName} is not a valid time");
        // format ipv4
        const ipv4 = /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/;
        ValidationRules
            .customRule("format_ipv4", (val) => val !== undefined ? ipv4.test(val) : true, this.configuration.messages.format_ipv4 || "${$displayName} is not a valid IPv4 address");
        // format ipv6
        // tslint:disable-next-line:max-line-length
        const ipv6 = /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i;
        ValidationRules
            .customRule("format_ipv6", (val) => val !== undefined ? ipv4.test(val) : true, this.configuration.messages.format_ipv6 || "${$displayName} is not a valid IPv6 address");
        // format hostname
        const hostname = /^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i;
        ValidationRules
            .customRule("format_hostname", (val) => val !== undefined ? ipv4.test(val) : true, this.configuration.messages.format_hostname || "${$displayName} is not a valid hostname");
        // format uri
        const uri = /^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i;
        ValidationRules
            .customRule("format_uri", (val) => val !== undefined ? uri.test(val) : true, this.configuration.messages.format_uri || "${$displayName} is not a valid URI");
    }
    bind(ctrl, rule) {
        if (ctrl.schema.pattern) {
            rule = rule.matches(new RegExp(ctrl.schema.pattern));
        }
        if (ctrl.schema.minLength) {
            rule = rule.minLength(ctrl.schema.minLength);
        }
        if (ctrl.schema.maxLength) {
            rule = rule.maxLength(ctrl.schema.maxLength);
        }
        if (ctrl.schema.format && ctrl.schema.format !== "email") {
            const rulename = `format_${ctrl.schema.format.replace("-", "")}`;
            rule = rule.satisfiesRule(rulename);
        }
        if (ctrl.schema.format === "email") {
            rule = rule.email();
        }
    }
};
StringRules = __decorate([
    inject(SchemaFormConfiguration),
    __metadata("design:paramtypes", [SchemaFormConfiguration])
], StringRules);
export { StringRules };

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDdEQ7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFO1lBQ3pCLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDOUM7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFO1lBQ3pCLElBQUksR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7U0FDOUM7UUFDRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxLQUFLLE9BQU8sRUFBRTtZQUN4RCxNQUFNLFFBQVEsR0FBRyxVQUFVLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNqRSxJQUFJLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUNyQztRQUNELElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEtBQUssT0FBTyxFQUFFO1lBQ2xDLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7U0FDckI7SUFDSCxDQUFDO0NBQ0YsQ0FBQTtBQW5HWSxXQUFXO0lBRHZCLE1BQU0sQ0FBQyx1QkFBdUIsQ0FBQztxQ0FFSyx1QkFBdUI7R0FEL0MsV0FBVyxDQW1HdkI7U0FuR1ksV0FBVyIsImZpbGUiOiJydWxlcy9zdHJpbmctcnVsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uUnVsZXMsIHZhbGlkYXRpb25NZXNzYWdlcywgRmx1ZW50UnVsZUN1c3RvbWl6ZXIgfSBmcm9tIFwiYXVyZWxpYS12YWxpZGF0aW9uXCI7XG5pbXBvcnQgeyBpbmplY3QgfSBmcm9tIFwiYXVyZWxpYS1mcmFtZXdvcmtcIjtcbmltcG9ydCB7IFNjaGVtYUZvcm1Db25maWd1cmF0aW9uIH0gZnJvbSBcIi4uL3NlcnZpY2VzL3NjaGVtYS1mb3JtLWNvbmZpZ3VyYXRpb25cIjtcbmltcG9ydCB7IFNmU3RyaW5nIH0gZnJvbSBcIi4uL2Zvcm0vdGV4dC9zZi1zdHJpbmdcIjtcblxuQGluamVjdChTY2hlbWFGb3JtQ29uZmlndXJhdGlvbilcbmV4cG9ydCBjbGFzcyBTdHJpbmdSdWxlcyB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlndXJhdGlvbjogU2NoZW1hRm9ybUNvbmZpZ3VyYXRpb24pIHsgfVxuICByZWdpc3RlcigpIHtcbiAgICB0aGlzLmFkZCgpO1xuICAgIHRoaXMuc2V0Q3VzdG9tTWVzc2FnZXMoKTtcbiAgfVxuXG4gIHNldEN1c3RvbU1lc3NhZ2VzKCkge1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1pbkxlbmd0aFwiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5taW5MZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzW1wibWluTGVuZ3RoXCJdO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1heExlbmd0aFwiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5tYXhMZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzW1wibWF4TGVuZ3RoXCJdO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1hdGNoZXNcIl0gPSB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMucGF0dGVybiB8fCB2YWxpZGF0aW9uTWVzc2FnZXNbXCJtYXRjaGVzXCJdO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcImVtYWlsXCJdID0gdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9lbWFpbCB8fCB2YWxpZGF0aW9uTWVzc2FnZXNbXCJlbWFpbFwiXTtcbiAgfVxuXG4gIGFkZCgpIHtcbiAgICAvLyBmb3JtYXQgZGF0ZXRpbWVcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgY29uc3QgaXNvODYwMURhdGV0aW1lID0gL15cXGRcXGRcXGRcXGQtWzAtMV1cXGQtWzAtM11cXGRbdFxcc10oPzpbMC0yXVxcZDpbMC01XVxcZDpbMC01XVxcZHwyMzo1OTo2MCkoPzpcXC5cXGQrKT8oPzp6fFsrLV1cXGRcXGQ6XFxkXFxkKSQvaTtcbiAgICBWYWxpZGF0aW9uUnVsZXNcbiAgICAgIC5jdXN0b21SdWxlKFxuICAgICAgICBcImZvcm1hdF9kYXRldGltZVwiLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMURhdGV0aW1lLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfZGF0ZXRpbWUgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgZGF0ZS90aW1lXCJcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgZGF0ZVxuICAgIGNvbnN0IGlzbzg2MDFEYXRlID0gL15cXGRcXGRcXGRcXGQtWzAtMV1cXGQtWzAtM11cXGQkLztcbiAgICBWYWxpZGF0aW9uUnVsZXNcbiAgICAgIC5jdXN0b21SdWxlKFxuICAgICAgICBcImZvcm1hdF9kYXRlXCIsXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gdmFsICE9PSB1bmRlZmluZWQgPyBpc284NjAxRGF0ZS50ZXN0KHZhbCkgOiB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2RhdGUgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgZGF0ZVwiXG4gICAgICApO1xuXG4gICAgLy8gZm9ybWF0IHRpbWVcbiAgICBjb25zdCBpc284NjAxVGltZSA9IC9eKD86WzAtMl1cXGQ6WzAtNV1cXGQ6WzAtNV1cXGR8MjM6NTk6NjApKD86XFwuXFxkKyk/KD86enxbKy1dXFxkXFxkOlxcZFxcZCk/JC9pO1xuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgIFwiZm9ybWF0X3RpbWVcIixcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IGlzbzg2MDFUaW1lLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfdGltZSB8fCBcIiR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCB0aW1lXCJcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgaXB2NFxuICAgIGNvbnN0IGlwdjQgPSAvXig/Oig/OjI1WzAtNV18MlswLTRdXFxkfFswMV0/XFxkXFxkPylcXC4pezN9KD86MjVbMC01XXwyWzAtNF1cXGR8WzAxXT9cXGRcXGQ/KSQvO1xuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgIFwiZm9ybWF0X2lwdjRcIixcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9pcHY0IHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIElQdjQgYWRkcmVzc1wiXG4gICAgICApO1xuXG4gICAgLy8gZm9ybWF0IGlwdjZcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgY29uc3QgaXB2NiA9IC9eXFxzKig/Oig/Oig/OlswLTlhLWZdezEsNH06KXs3fSg/OlswLTlhLWZdezEsNH18OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXs2fSg/OjpbMC05YS1mXXsxLDR9fCg/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7NX0oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSwyfSl8Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7NH0oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSwzfSl8KD86KD86OlswLTlhLWZdezEsNH0pPzooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXszfSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDR9KXwoPzooPzo6WzAtOWEtZl17MSw0fSl7MCwyfTooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXsyfSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDV9KXwoPzooPzo6WzAtOWEtZl17MSw0fSl7MCwzfTooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KSl8OikpfCg/Oig/OlswLTlhLWZdezEsNH06KXsxfSg/Oig/Oig/OjpbMC05YS1mXXsxLDR9KXsxLDZ9KXwoPzooPzo6WzAtOWEtZl17MSw0fSl7MCw0fTooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KSl8OikpfCg/OjooPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw3fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsNX06KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKSkoPzolLispP1xccyokL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgXCJmb3JtYXRfaXB2NlwiLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXB2NC50ZXN0KHZhbCkgOiB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2lwdjYgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgSVB2NiBhZGRyZXNzXCJcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgaG9zdG5hbWVcbiAgICBjb25zdCBob3N0bmFtZSA9IC9eW2EtejAtOV0oPzpbYS16MC05LV17MCw2MX1bYS16MC05XSk/KD86XFwuW2EtejAtOV0oPzpbLTAtOWEtel17MCw2MX1bMC05YS16XSk/KSokL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgXCJmb3JtYXRfaG9zdG5hbWVcIixcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9ob3N0bmFtZSB8fCBcIiR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBob3N0bmFtZVwiXG4gICAgICApO1xuXG4gICAgLy8gZm9ybWF0IHVyaVxuICAgIGNvbnN0IHVyaSA9IC9eKD86W2Etel1bYS16MC05Ky0uXSo6KSg/OlxcLz9cXC8pP1teXFxzXSokL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgXCJmb3JtYXRfdXJpXCIsXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gdmFsICE9PSB1bmRlZmluZWQgPyB1cmkudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF91cmkgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgVVJJXCJcbiAgICAgICk7XG4gIH1cblxuICBiaW5kKGN0cmw6IFNmU3RyaW5nLCBydWxlOiBGbHVlbnRSdWxlQ3VzdG9taXplcjx7fSwgYW55Pikge1xuICAgIGlmIChjdHJsLnNjaGVtYS5wYXR0ZXJuKSB7XG4gICAgICBydWxlID0gcnVsZS5tYXRjaGVzKG5ldyBSZWdFeHAoY3RybC5zY2hlbWEucGF0dGVybikpO1xuICAgIH1cbiAgICBpZiAoY3RybC5zY2hlbWEubWluTGVuZ3RoKSB7XG4gICAgICBydWxlID0gcnVsZS5taW5MZW5ndGgoY3RybC5zY2hlbWEubWluTGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKGN0cmwuc2NoZW1hLm1heExlbmd0aCkge1xuICAgICAgcnVsZSA9IHJ1bGUubWF4TGVuZ3RoKGN0cmwuc2NoZW1hLm1heExlbmd0aCk7XG4gICAgfVxuICAgIGlmIChjdHJsLnNjaGVtYS5mb3JtYXQgJiYgY3RybC5zY2hlbWEuZm9ybWF0ICE9PSBcImVtYWlsXCIpIHtcbiAgICAgIGNvbnN0IHJ1bGVuYW1lID0gYGZvcm1hdF8ke2N0cmwuc2NoZW1hLmZvcm1hdC5yZXBsYWNlKFwiLVwiLCBcIlwiKX1gO1xuICAgICAgcnVsZSA9IHJ1bGUuc2F0aXNmaWVzUnVsZShydWxlbmFtZSk7XG4gICAgfVxuICAgIGlmIChjdHJsLnNjaGVtYS5mb3JtYXQgPT09IFwiZW1haWxcIikge1xuICAgICAgcnVsZSA9IHJ1bGUuZW1haWwoKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290Ijoic3JjIn0=
