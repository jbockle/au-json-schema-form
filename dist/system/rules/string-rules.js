System.register(["aurelia-validation", "aurelia-framework", "../services/schema-form-configuration"], function (exports_1, context_1) {
    "use strict";
    var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
        else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
    };
    var __metadata = (this && this.__metadata) || function (k, v) {
        if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
    };
    var aurelia_validation_1, aurelia_framework_1, schema_form_configuration_1, StringRules;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (aurelia_validation_1_1) {
                aurelia_validation_1 = aurelia_validation_1_1;
            },
            function (aurelia_framework_1_1) {
                aurelia_framework_1 = aurelia_framework_1_1;
            },
            function (schema_form_configuration_1_1) {
                schema_form_configuration_1 = schema_form_configuration_1_1;
            }
        ],
        execute: function () {
            StringRules = /** @class */ (function () {
                function StringRules(configuration) {
                    this.configuration = configuration;
                }
                StringRules.prototype.register = function () {
                    this.add();
                    this.setCustomMessages();
                };
                StringRules.prototype.setCustomMessages = function () {
                    aurelia_validation_1.validationMessages["minLength"] = this.configuration.messages.minLength || aurelia_validation_1.validationMessages["minLength"];
                    aurelia_validation_1.validationMessages["maxLength"] = this.configuration.messages.maxLength || aurelia_validation_1.validationMessages["maxLength"];
                    aurelia_validation_1.validationMessages["matches"] = this.configuration.messages.pattern || aurelia_validation_1.validationMessages["matches"];
                    aurelia_validation_1.validationMessages["email"] = this.configuration.messages.format_email || aurelia_validation_1.validationMessages["email"];
                };
                StringRules.prototype.add = function () {
                    // format datetime
                    // tslint:disable-next-line:max-line-length
                    var iso8601Datetime = /^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_datetime", function (val) { return val !== undefined ? iso8601Datetime.test(val) : true; }, this.configuration.messages.format_datetime || "${$displayName} is not a valid date/time.");
                    // format date
                    var iso8601Date = /^\d\d\d\d-[0-1]\d-[0-3]\d$/;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_date", function (val) { return val !== undefined ? iso8601Date.test(val) : true; }, this.configuration.messages.format_date || "${$displayName} is not a valid date.");
                    // format time
                    var iso8601Time = /^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_time", function (val) { return val !== undefined ? iso8601Time.test(val) : true; }, this.configuration.messages.format_time || "${$displayName} is not a valid time.");
                    // format ipv4
                    var ipv4 = /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_ipv4", function (val) { return val !== undefined ? ipv4.test(val) : true; }, this.configuration.messages.format_ipv4 || "${$displayName} is not a valid IPv4 address.");
                    // format ipv6
                    // tslint:disable-next-line:max-line-length
                    var ipv6 = /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_ipv6", function (val) { return val !== undefined ? ipv4.test(val) : true; }, this.configuration.messages.format_ipv6 || "${$displayName} is not a valid IPv6 address.");
                    // format hostname
                    var hostname = /^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_hostname", function (val) { return val !== undefined ? ipv4.test(val) : true; }, this.configuration.messages.format_hostname || "${$displayName} is not a valid hostname.");
                    // format uri
                    var uri = /^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i;
                    aurelia_validation_1.ValidationRules
                        .customRule("format_uri", function (val) { return val !== undefined ? uri.test(val) : true; }, this.configuration.messages.format_uri || "${$displayName} is not a valid URI.");
                    // pattern
                    aurelia_validation_1.ValidationRules
                        .customRule("pattern", function (val, obj, pattern) { return val !== undefined ? (new RegExp(pattern)).test(val) : true; }, this.configuration.messages.pattern || "${$displayName} is not correctly formatted.", function (pattern) { return ({ pattern: pattern }); });
                };
                StringRules.prototype.bind = function (ctrl, rule) {
                    if (ctrl.form.$schema.pattern) {
                        rule = rule.satisfiesRule("pattern", ctrl.form.$schema.pattern);
                    }
                    if (ctrl.form.$schema.minLength) {
                        rule = rule.minLength(ctrl.form.$schema.minLength);
                    }
                    if (ctrl.form.$schema.maxLength) {
                        rule = rule.maxLength(ctrl.form.$schema.maxLength);
                    }
                    if (ctrl.form.$schema.format && ctrl.form.$schema.format !== "email") {
                        var rulename = "format_" + ctrl.form.$schema.format.replace("-", "");
                        rule = rule.satisfiesRule(rulename);
                    }
                    if (ctrl.form.$schema.format === "email") {
                        rule = rule.email();
                    }
                };
                StringRules = __decorate([
                    aurelia_framework_1.inject(schema_form_configuration_1.SchemaFormConfiguration),
                    __metadata("design:paramtypes", [schema_form_configuration_1.SchemaFormConfiguration])
                ], StringRules);
                return StringRules;
            }());
            exports_1("StringRules", StringRules);
        }
    };
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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SUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztxQkFDckM7b0JBQ0QsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssT0FBTyxFQUFFO3dCQUN4QyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO3FCQUNyQjtnQkFDSCxDQUFDO2dCQTNHVSxXQUFXO29CQUR2QiwwQkFBTSxDQUFDLG1EQUF1QixDQUFDO3FEQUVLLG1EQUF1QjttQkFEL0MsV0FBVyxDQTRHdkI7Z0JBQUQsa0JBQUM7YUE1R0QsQUE0R0M7O1FBQ0QsQ0FBQyIsImZpbGUiOiJydWxlcy9zdHJpbmctcnVsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uUnVsZXMsIHZhbGlkYXRpb25NZXNzYWdlcywgRmx1ZW50UnVsZUN1c3RvbWl6ZXIgfSBmcm9tIFwiYXVyZWxpYS12YWxpZGF0aW9uXCI7XHJcbmltcG9ydCB7IGluamVjdCB9IGZyb20gXCJhdXJlbGlhLWZyYW1ld29ya1wiO1xyXG5pbXBvcnQgeyBTY2hlbWFGb3JtQ29uZmlndXJhdGlvbiB9IGZyb20gXCIuLi9zZXJ2aWNlcy9zY2hlbWEtZm9ybS1jb25maWd1cmF0aW9uXCI7XHJcbmltcG9ydCB7IFNmU3RyaW5nIH0gZnJvbSBcIi4uL2Zvcm0vdGV4dC9zZi1zdHJpbmdcIjtcclxuXHJcbkBpbmplY3QoU2NoZW1hRm9ybUNvbmZpZ3VyYXRpb24pXHJcbmV4cG9ydCBjbGFzcyBTdHJpbmdSdWxlcyB7XHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBjb25maWd1cmF0aW9uOiBTY2hlbWFGb3JtQ29uZmlndXJhdGlvbikgeyB9XHJcbiAgcmVnaXN0ZXIoKSB7XHJcbiAgICB0aGlzLmFkZCgpO1xyXG4gICAgdGhpcy5zZXRDdXN0b21NZXNzYWdlcygpO1xyXG4gIH1cclxuXHJcbiAgc2V0Q3VzdG9tTWVzc2FnZXMoKSB7XHJcbiAgICB2YWxpZGF0aW9uTWVzc2FnZXNbXCJtaW5MZW5ndGhcIl0gPSB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMubWluTGVuZ3RoIHx8IHZhbGlkYXRpb25NZXNzYWdlc1tcIm1pbkxlbmd0aFwiXTtcclxuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1heExlbmd0aFwiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5tYXhMZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzW1wibWF4TGVuZ3RoXCJdO1xyXG4gICAgdmFsaWRhdGlvbk1lc3NhZ2VzW1wibWF0Y2hlc1wiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5wYXR0ZXJuIHx8IHZhbGlkYXRpb25NZXNzYWdlc1tcIm1hdGNoZXNcIl07XHJcbiAgICB2YWxpZGF0aW9uTWVzc2FnZXNbXCJlbWFpbFwiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfZW1haWwgfHwgdmFsaWRhdGlvbk1lc3NhZ2VzW1wiZW1haWxcIl07XHJcbiAgfVxyXG5cclxuICBhZGQoKSB7XHJcbiAgICAvLyBmb3JtYXQgZGF0ZXRpbWVcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICAgIGNvbnN0IGlzbzg2MDFEYXRldGltZSA9IC9eXFxkXFxkXFxkXFxkLVswLTFdXFxkLVswLTNdXFxkW3RcXHNdKD86WzAtMl1cXGQ6WzAtNV1cXGQ6WzAtNV1cXGR8MjM6NTk6NjApKD86XFwuXFxkKyk/KD86enxbKy1dXFxkXFxkOlxcZFxcZCkkL2k7XHJcbiAgICBWYWxpZGF0aW9uUnVsZXNcclxuICAgICAgLmN1c3RvbVJ1bGUoXHJcbiAgICAgICAgXCJmb3JtYXRfZGF0ZXRpbWVcIixcclxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMURhdGV0aW1lLnRlc3QodmFsKSA6IHRydWUsXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9kYXRldGltZSB8fCBcIiR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBkYXRlL3RpbWUuXCJcclxuICAgICAgKTtcclxuXHJcbiAgICAvLyBmb3JtYXQgZGF0ZVxyXG4gICAgY29uc3QgaXNvODYwMURhdGUgPSAvXlxcZFxcZFxcZFxcZC1bMC0xXVxcZC1bMC0zXVxcZCQvO1xyXG4gICAgVmFsaWRhdGlvblJ1bGVzXHJcbiAgICAgIC5jdXN0b21SdWxlKFxyXG4gICAgICAgIFwiZm9ybWF0X2RhdGVcIixcclxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMURhdGUudGVzdCh2YWwpIDogdHJ1ZSxcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2RhdGUgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgZGF0ZS5cIlxyXG4gICAgICApO1xyXG5cclxuICAgIC8vIGZvcm1hdCB0aW1lXHJcbiAgICBjb25zdCBpc284NjAxVGltZSA9IC9eKD86WzAtMl1cXGQ6WzAtNV1cXGQ6WzAtNV1cXGR8MjM6NTk6NjApKD86XFwuXFxkKyk/KD86enxbKy1dXFxkXFxkOlxcZFxcZCk/JC9pO1xyXG4gICAgVmFsaWRhdGlvblJ1bGVzXHJcbiAgICAgIC5jdXN0b21SdWxlKFxyXG4gICAgICAgIFwiZm9ybWF0X3RpbWVcIixcclxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMVRpbWUudGVzdCh2YWwpIDogdHJ1ZSxcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X3RpbWUgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgdGltZS5cIlxyXG4gICAgICApO1xyXG5cclxuICAgIC8vIGZvcm1hdCBpcHY0XHJcbiAgICBjb25zdCBpcHY0ID0gL14oPzooPzoyNVswLTVdfDJbMC00XVxcZHxbMDFdP1xcZFxcZD8pXFwuKXszfSg/OjI1WzAtNV18MlswLTRdXFxkfFswMV0/XFxkXFxkPykkLztcclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICBcImZvcm1hdF9pcHY0XCIsXHJcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcclxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2lwdjQgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgSVB2NCBhZGRyZXNzLlwiXHJcbiAgICAgICk7XHJcblxyXG4gICAgLy8gZm9ybWF0IGlwdjZcclxuICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTptYXgtbGluZS1sZW5ndGhcclxuICAgIGNvbnN0IGlwdjYgPSAvXlxccyooPzooPzooPzpbMC05YS1mXXsxLDR9Oil7N30oPzpbMC05YS1mXXsxLDR9fDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7Nn0oPzo6WzAtOWEtZl17MSw0fXwoPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezV9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsMn0pfDooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezR9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsM30pfCg/Oig/OjpbMC05YS1mXXsxLDR9KT86KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7M30oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw0fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsMn06KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7Mn0oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw1fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsM306KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7MX0oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw2fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsNH06KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzo6KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsN30pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDV9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSkpKD86JS4rKT9cXHMqJC9pO1xyXG4gICAgVmFsaWRhdGlvblJ1bGVzXHJcbiAgICAgIC5jdXN0b21SdWxlKFxyXG4gICAgICAgIFwiZm9ybWF0X2lwdjZcIixcclxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXB2NC50ZXN0KHZhbCkgOiB0cnVlLFxyXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfaXB2NiB8fCBcIiR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBJUHY2IGFkZHJlc3MuXCJcclxuICAgICAgKTtcclxuXHJcbiAgICAvLyBmb3JtYXQgaG9zdG5hbWVcclxuICAgIGNvbnN0IGhvc3RuYW1lID0gL15bYS16MC05XSg/OlthLXowLTktXXswLDYxfVthLXowLTldKT8oPzpcXC5bYS16MC05XSg/OlstMC05YS16XXswLDYxfVswLTlhLXpdKT8pKiQvaTtcclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICBcImZvcm1hdF9ob3N0bmFtZVwiLFxyXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gdmFsICE9PSB1bmRlZmluZWQgPyBpcHY0LnRlc3QodmFsKSA6IHRydWUsXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9ob3N0bmFtZSB8fCBcIiR7JGRpc3BsYXlOYW1lfSBpcyBub3QgYSB2YWxpZCBob3N0bmFtZS5cIlxyXG4gICAgICApO1xyXG5cclxuICAgIC8vIGZvcm1hdCB1cmlcclxuICAgIGNvbnN0IHVyaSA9IC9eKD86W2Etel1bYS16MC05Ky0uXSo6KSg/OlxcLz9cXC8pP1teXFxzXSokL2k7XHJcbiAgICBWYWxpZGF0aW9uUnVsZXNcclxuICAgICAgLmN1c3RvbVJ1bGUoXHJcbiAgICAgICAgXCJmb3JtYXRfdXJpXCIsXHJcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IHVyaS50ZXN0KHZhbCkgOiB0cnVlLFxyXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfdXJpIHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIFVSSS5cIlxyXG4gICAgICApO1xyXG5cclxuICAgIC8vIHBhdHRlcm5cclxuICAgIFZhbGlkYXRpb25SdWxlc1xyXG4gICAgICAuY3VzdG9tUnVsZShcclxuICAgICAgICBcInBhdHRlcm5cIixcclxuICAgICAgICAodmFsLCBvYmosIHBhdHRlcm4pID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gKG5ldyBSZWdFeHAocGF0dGVybikpLnRlc3QodmFsKSA6IHRydWUsXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLnBhdHRlcm4gfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGNvcnJlY3RseSBmb3JtYXR0ZWQuXCIsXHJcbiAgICAgICAgKHBhdHRlcm4pID0+ICh7IHBhdHRlcm4gfSlcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIGJpbmQoY3RybDogU2ZTdHJpbmcsIHJ1bGU6IEZsdWVudFJ1bGVDdXN0b21pemVyPHt9LCBhbnk+KSB7XHJcbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEucGF0dGVybikge1xyXG4gICAgICBydWxlID0gcnVsZS5zYXRpc2ZpZXNSdWxlKFwicGF0dGVyblwiLCBjdHJsLmZvcm0uJHNjaGVtYS5wYXR0ZXJuKTtcclxuICAgIH1cclxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5taW5MZW5ndGgpIHtcclxuICAgICAgcnVsZSA9IHJ1bGUubWluTGVuZ3RoKGN0cmwuZm9ybS4kc2NoZW1hLm1pbkxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEubWF4TGVuZ3RoKSB7XHJcbiAgICAgIHJ1bGUgPSBydWxlLm1heExlbmd0aChjdHJsLmZvcm0uJHNjaGVtYS5tYXhMZW5ndGgpO1xyXG4gICAgfVxyXG4gICAgaWYgKGN0cmwuZm9ybS4kc2NoZW1hLmZvcm1hdCAmJiBjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQgIT09IFwiZW1haWxcIikge1xyXG4gICAgICBjb25zdCBydWxlbmFtZSA9IGBmb3JtYXRfJHtjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQucmVwbGFjZShcIi1cIiwgXCJcIil9YDtcclxuICAgICAgcnVsZSA9IHJ1bGUuc2F0aXNmaWVzUnVsZShydWxlbmFtZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEuZm9ybWF0ID09PSBcImVtYWlsXCIpIHtcclxuICAgICAgcnVsZSA9IHJ1bGUuZW1haWwoKTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiJzcmMifQ==
