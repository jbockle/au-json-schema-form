var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __metadata = (this && this.__metadata) || function (k, v) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(k, v);
};
define(["require", "exports", "aurelia-validation", "aurelia-framework", "../services/schema-form-configuration"], function (require, exports, aurelia_validation_1, aurelia_framework_1, schema_form_configuration_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var StringRules = /** @class */ (function () {
        function StringRules(configuration) {
            this.configuration = configuration;
        }
        StringRules.prototype.register = function () {
            this.add();
            this.setCustomMessages();
        };
        StringRules.prototype.setCustomMessages = function () {
            aurelia_validation_1.validationMessages["minLength"] = this.configuration.messages.minLength || aurelia_validation_1.validationMessages["minLength"];
            aurelia_validation_1.validationMessages["maxLength"] = this.configuration.messages.maxLength || aurelia_validation_1.validationMessages["maxLength"];
            aurelia_validation_1.validationMessages["matches"] = this.configuration.messages.pattern || aurelia_validation_1.validationMessages["matches"];
            aurelia_validation_1.validationMessages["email"] = this.configuration.messages.format_email || aurelia_validation_1.validationMessages["email"];
        };
        StringRules.prototype.add = function () {
            // format datetime
            // tslint:disable-next-line:max-line-length
            var iso8601Datetime = /^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)$/i;
            aurelia_validation_1.ValidationRules
                .customRule("format_datetime", function (val) { return val !== undefined ? iso8601Datetime.test(val) : true; }, this.configuration.messages.format_datetime || "${$displayName} is not a valid date/time.");
            // format date
            var iso8601Date = /^\d\d\d\d-[0-1]\d-[0-3]\d$/;
            aurelia_validation_1.ValidationRules
                .customRule("format_date", function (val) { return val !== undefined ? iso8601Date.test(val) : true; }, this.configuration.messages.format_date || "${$displayName} is not a valid date.");
            // format time
            var iso8601Time = /^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d:\d\d)?$/i;
            aurelia_validation_1.ValidationRules
                .customRule("format_time", function (val) { return val !== undefined ? iso8601Time.test(val) : true; }, this.configuration.messages.format_time || "${$displayName} is not a valid time.");
            // format ipv4
            var ipv4 = /^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/;
            aurelia_validation_1.ValidationRules
                .customRule("format_ipv4", function (val) { return val !== undefined ? ipv4.test(val) : true; }, this.configuration.messages.format_ipv4 || "${$displayName} is not a valid IPv4 address.");
            // format ipv6
            // tslint:disable-next-line:max-line-length
            var ipv6 = /^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i;
            aurelia_validation_1.ValidationRules
                .customRule("format_ipv6", function (val) { return val !== undefined ? ipv4.test(val) : true; }, this.configuration.messages.format_ipv6 || "${$displayName} is not a valid IPv6 address.");
            // format hostname
            var hostname = /^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*$/i;
            aurelia_validation_1.ValidationRules
                .customRule("format_hostname", function (val) { return val !== undefined ? ipv4.test(val) : true; }, this.configuration.messages.format_hostname || "${$displayName} is not a valid hostname.");
            // format uri
            var uri = /^(?:[a-z][a-z0-9+-.]*:)(?:\/?\/)?[^\s]*$/i;
            aurelia_validation_1.ValidationRules
                .customRule("format_uri", function (val) { return val !== undefined ? uri.test(val) : true; }, this.configuration.messages.format_uri || "${$displayName} is not a valid URI.");
            // pattern
            aurelia_validation_1.ValidationRules
                .customRule("pattern", function (val, obj, pattern) { return val !== undefined ? (new RegExp(pattern)).test(val) : true; }, this.configuration.messages.pattern || "${$displayName} is not correctly formatted.", function (pattern) { return ({ pattern: pattern }); });
        };
        StringRules.prototype.bind = function (ctrl, rule) {
            if (ctrl.form.$schema.pattern) {
                rule = rule.satisfiesRule("pattern", ctrl.form.$schema.pattern);
            }
            if (ctrl.form.$schema.minLength) {
                rule = rule.minLength(ctrl.form.$schema.minLength);
            }
            if (ctrl.form.$schema.maxLength) {
                rule = rule.maxLength(ctrl.form.$schema.maxLength);
            }
            if (ctrl.form.$schema.format && ctrl.form.$schema.format !== "email") {
                var rulename = "format_" + ctrl.form.$schema.format.replace("-", "");
                rule = rule.satisfiesRule(rulename);
            }
            if (ctrl.form.$schema.format === "email") {
                rule = rule.email();
            }
        };
        StringRules = __decorate([
            aurelia_framework_1.inject(schema_form_configuration_1.SchemaFormConfiguration),
            __metadata("design:paramtypes", [schema_form_configuration_1.SchemaFormConfiguration])
        ], StringRules);
        return StringRules;
    }());
    exports.StringRules = StringRules;
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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QUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEtBQUssT0FBTyxFQUFFO2dCQUN4QyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2FBQ3JCO1FBQ0gsQ0FBQztRQTNHVSxXQUFXO1lBRHZCLDBCQUFNLENBQUMsbURBQXVCLENBQUM7NkNBRUssbURBQXVCO1dBRC9DLFdBQVcsQ0E0R3ZCO1FBQUQsa0JBQUM7S0E1R0QsQUE0R0MsSUFBQTtJQTVHWSxrQ0FBVyIsImZpbGUiOiJydWxlcy9zdHJpbmctcnVsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWYWxpZGF0aW9uUnVsZXMsIHZhbGlkYXRpb25NZXNzYWdlcywgRmx1ZW50UnVsZUN1c3RvbWl6ZXIgfSBmcm9tIFwiYXVyZWxpYS12YWxpZGF0aW9uXCI7XG5pbXBvcnQgeyBpbmplY3QgfSBmcm9tIFwiYXVyZWxpYS1mcmFtZXdvcmtcIjtcbmltcG9ydCB7IFNjaGVtYUZvcm1Db25maWd1cmF0aW9uIH0gZnJvbSBcIi4uL3NlcnZpY2VzL3NjaGVtYS1mb3JtLWNvbmZpZ3VyYXRpb25cIjtcbmltcG9ydCB7IFNmU3RyaW5nIH0gZnJvbSBcIi4uL2Zvcm0vdGV4dC9zZi1zdHJpbmdcIjtcblxuQGluamVjdChTY2hlbWFGb3JtQ29uZmlndXJhdGlvbilcbmV4cG9ydCBjbGFzcyBTdHJpbmdSdWxlcyB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgY29uZmlndXJhdGlvbjogU2NoZW1hRm9ybUNvbmZpZ3VyYXRpb24pIHsgfVxuICByZWdpc3RlcigpIHtcbiAgICB0aGlzLmFkZCgpO1xuICAgIHRoaXMuc2V0Q3VzdG9tTWVzc2FnZXMoKTtcbiAgfVxuXG4gIHNldEN1c3RvbU1lc3NhZ2VzKCkge1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1pbkxlbmd0aFwiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5taW5MZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzW1wibWluTGVuZ3RoXCJdO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1heExlbmd0aFwiXSA9IHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5tYXhMZW5ndGggfHwgdmFsaWRhdGlvbk1lc3NhZ2VzW1wibWF4TGVuZ3RoXCJdO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcIm1hdGNoZXNcIl0gPSB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMucGF0dGVybiB8fCB2YWxpZGF0aW9uTWVzc2FnZXNbXCJtYXRjaGVzXCJdO1xuICAgIHZhbGlkYXRpb25NZXNzYWdlc1tcImVtYWlsXCJdID0gdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9lbWFpbCB8fCB2YWxpZGF0aW9uTWVzc2FnZXNbXCJlbWFpbFwiXTtcbiAgfVxuXG4gIGFkZCgpIHtcbiAgICAvLyBmb3JtYXQgZGF0ZXRpbWVcbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgY29uc3QgaXNvODYwMURhdGV0aW1lID0gL15cXGRcXGRcXGRcXGQtWzAtMV1cXGQtWzAtM11cXGRbdFxcc10oPzpbMC0yXVxcZDpbMC01XVxcZDpbMC01XVxcZHwyMzo1OTo2MCkoPzpcXC5cXGQrKT8oPzp6fFsrLV1cXGRcXGQ6XFxkXFxkKSQvaTtcbiAgICBWYWxpZGF0aW9uUnVsZXNcbiAgICAgIC5jdXN0b21SdWxlKFxuICAgICAgICBcImZvcm1hdF9kYXRldGltZVwiLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMURhdGV0aW1lLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5mb3JtYXRfZGF0ZXRpbWUgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgZGF0ZS90aW1lLlwiXG4gICAgICApO1xuXG4gICAgLy8gZm9ybWF0IGRhdGVcbiAgICBjb25zdCBpc284NjAxRGF0ZSA9IC9eXFxkXFxkXFxkXFxkLVswLTFdXFxkLVswLTNdXFxkJC87XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgXCJmb3JtYXRfZGF0ZVwiLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMURhdGUudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9kYXRlIHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIGRhdGUuXCJcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgdGltZVxuICAgIGNvbnN0IGlzbzg2MDFUaW1lID0gL14oPzpbMC0yXVxcZDpbMC01XVxcZDpbMC01XVxcZHwyMzo1OTo2MCkoPzpcXC5cXGQrKT8oPzp6fFsrLV1cXGRcXGQ6XFxkXFxkKT8kL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgXCJmb3JtYXRfdGltZVwiLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXNvODYwMVRpbWUudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF90aW1lIHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIHRpbWUuXCJcbiAgICAgICk7XG5cbiAgICAvLyBmb3JtYXQgaXB2NFxuICAgIGNvbnN0IGlwdjQgPSAvXig/Oig/OjI1WzAtNV18MlswLTRdXFxkfFswMV0/XFxkXFxkPylcXC4pezN9KD86MjVbMC01XXwyWzAtNF1cXGR8WzAxXT9cXGRcXGQ/KSQvO1xuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgIFwiZm9ybWF0X2lwdjRcIixcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9pcHY0IHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIElQdjQgYWRkcmVzcy5cIlxuICAgICAgKTtcblxuICAgIC8vIGZvcm1hdCBpcHY2XG4gICAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICAgIGNvbnN0IGlwdjYgPSAvXlxccyooPzooPzooPzpbMC05YS1mXXsxLDR9Oil7N30oPzpbMC05YS1mXXsxLDR9fDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7Nn0oPzo6WzAtOWEtZl17MSw0fXwoPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezV9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsMn0pfDooPzooPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkoPzpcXC4oPzoyNVswLTVdfDJbMC00XVxcZHwxXFxkXFxkfFsxLTldP1xcZCkpezN9KXw6KSl8KD86KD86WzAtOWEtZl17MSw0fTopezR9KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsM30pfCg/Oig/OjpbMC05YS1mXXsxLDR9KT86KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7M30oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw0fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsMn06KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7Mn0oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw1fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsM306KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzooPzpbMC05YS1mXXsxLDR9Oil7MX0oPzooPzooPzo6WzAtOWEtZl17MSw0fSl7MSw2fSl8KD86KD86OlswLTlhLWZdezEsNH0pezAsNH06KD86KD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKD86XFwuKD86MjVbMC01XXwyWzAtNF1cXGR8MVxcZFxcZHxbMS05XT9cXGQpKXszfSkpfDopKXwoPzo6KD86KD86KD86OlswLTlhLWZdezEsNH0pezEsN30pfCg/Oig/OjpbMC05YS1mXXsxLDR9KXswLDV9Oig/Oig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSg/OlxcLig/OjI1WzAtNV18MlswLTRdXFxkfDFcXGRcXGR8WzEtOV0/XFxkKSl7M30pKXw6KSkpKD86JS4rKT9cXHMqJC9pO1xuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgIFwiZm9ybWF0X2lwdjZcIixcbiAgICAgICAgKHZhbDogc3RyaW5nKSA9PiB2YWwgIT09IHVuZGVmaW5lZCA/IGlwdjQudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF9pcHY2IHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIElQdjYgYWRkcmVzcy5cIlxuICAgICAgKTtcblxuICAgIC8vIGZvcm1hdCBob3N0bmFtZVxuICAgIGNvbnN0IGhvc3RuYW1lID0gL15bYS16MC05XSg/OlthLXowLTktXXswLDYxfVthLXowLTldKT8oPzpcXC5bYS16MC05XSg/OlstMC05YS16XXswLDYxfVswLTlhLXpdKT8pKiQvaTtcbiAgICBWYWxpZGF0aW9uUnVsZXNcbiAgICAgIC5jdXN0b21SdWxlKFxuICAgICAgICBcImZvcm1hdF9ob3N0bmFtZVwiLFxuICAgICAgICAodmFsOiBzdHJpbmcpID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gaXB2NC50ZXN0KHZhbCkgOiB0cnVlLFxuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb24ubWVzc2FnZXMuZm9ybWF0X2hvc3RuYW1lIHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBhIHZhbGlkIGhvc3RuYW1lLlwiXG4gICAgICApO1xuXG4gICAgLy8gZm9ybWF0IHVyaVxuICAgIGNvbnN0IHVyaSA9IC9eKD86W2Etel1bYS16MC05Ky0uXSo6KSg/OlxcLz9cXC8pP1teXFxzXSokL2k7XG4gICAgVmFsaWRhdGlvblJ1bGVzXG4gICAgICAuY3VzdG9tUnVsZShcbiAgICAgICAgXCJmb3JtYXRfdXJpXCIsXG4gICAgICAgICh2YWw6IHN0cmluZykgPT4gdmFsICE9PSB1bmRlZmluZWQgPyB1cmkudGVzdCh2YWwpIDogdHJ1ZSxcbiAgICAgICAgdGhpcy5jb25maWd1cmF0aW9uLm1lc3NhZ2VzLmZvcm1hdF91cmkgfHwgXCIkeyRkaXNwbGF5TmFtZX0gaXMgbm90IGEgdmFsaWQgVVJJLlwiXG4gICAgICApO1xuXG4gICAgLy8gcGF0dGVyblxuICAgIFZhbGlkYXRpb25SdWxlc1xuICAgICAgLmN1c3RvbVJ1bGUoXG4gICAgICAgIFwicGF0dGVyblwiLFxuICAgICAgICAodmFsLCBvYmosIHBhdHRlcm4pID0+IHZhbCAhPT0gdW5kZWZpbmVkID8gKG5ldyBSZWdFeHAocGF0dGVybikpLnRlc3QodmFsKSA6IHRydWUsXG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5tZXNzYWdlcy5wYXR0ZXJuIHx8IFwiJHskZGlzcGxheU5hbWV9IGlzIG5vdCBjb3JyZWN0bHkgZm9ybWF0dGVkLlwiLFxuICAgICAgICAocGF0dGVybikgPT4gKHsgcGF0dGVybiB9KVxuICAgICAgKTtcbiAgfVxuXG4gIGJpbmQoY3RybDogU2ZTdHJpbmcsIHJ1bGU6IEZsdWVudFJ1bGVDdXN0b21pemVyPHt9LCBhbnk+KSB7XG4gICAgaWYgKGN0cmwuZm9ybS4kc2NoZW1hLnBhdHRlcm4pIHtcbiAgICAgIHJ1bGUgPSBydWxlLnNhdGlzZmllc1J1bGUoXCJwYXR0ZXJuXCIsIGN0cmwuZm9ybS4kc2NoZW1hLnBhdHRlcm4pO1xuICAgIH1cbiAgICBpZiAoY3RybC5mb3JtLiRzY2hlbWEubWluTGVuZ3RoKSB7XG4gICAgICBydWxlID0gcnVsZS5taW5MZW5ndGgoY3RybC5mb3JtLiRzY2hlbWEubWluTGVuZ3RoKTtcbiAgICB9XG4gICAgaWYgKGN0cmwuZm9ybS4kc2NoZW1hLm1heExlbmd0aCkge1xuICAgICAgcnVsZSA9IHJ1bGUubWF4TGVuZ3RoKGN0cmwuZm9ybS4kc2NoZW1hLm1heExlbmd0aCk7XG4gICAgfVxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQgJiYgY3RybC5mb3JtLiRzY2hlbWEuZm9ybWF0ICE9PSBcImVtYWlsXCIpIHtcbiAgICAgIGNvbnN0IHJ1bGVuYW1lID0gYGZvcm1hdF8ke2N0cmwuZm9ybS4kc2NoZW1hLmZvcm1hdC5yZXBsYWNlKFwiLVwiLCBcIlwiKX1gO1xuICAgICAgcnVsZSA9IHJ1bGUuc2F0aXNmaWVzUnVsZShydWxlbmFtZSk7XG4gICAgfVxuICAgIGlmIChjdHJsLmZvcm0uJHNjaGVtYS5mb3JtYXQgPT09IFwiZW1haWxcIikge1xuICAgICAgcnVsZSA9IHJ1bGUuZW1haWwoKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJzb3VyY2VSb290Ijoic3JjIn0=
